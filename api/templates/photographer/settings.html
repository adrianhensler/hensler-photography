{% extends 'photographer/base.html' %}
{% block styles %}
<style>
    .settings-page {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 24px;
        padding: 24px;
    }

    .settings-card {
        background: var(--bg-primary);
        border: 1px solid var(--border-light);
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        padding: 20px 24px;
    }

    .settings-card h2 {
        font-size: 1.05rem;
        margin-bottom: 12px;
        color: var(--text-primary);
    }

    .settings-card p {
        color: var(--text-secondary);
        margin-bottom: 16px;
        line-height: 1.5;
    }

    .settings-field {
        display: flex;
        flex-direction: column;
        gap: 6px;
        margin-bottom: 14px;
    }

    .settings-field label {
        font-size: 0.9rem;
        color: var(--text-secondary);
    }

    .settings-field input,
    .settings-field select,
    .settings-field textarea {
        border: 1px solid var(--border-light);
        border-radius: 8px;
        padding: 10px;
        background: var(--bg-secondary);
        color: var(--text-primary);
    }

    .settings-actions {
        display: flex;
        gap: 10px;
        margin-top: 10px;
    }

    .btn-primary {
        background: var(--accent);
        color: #fff;
        border: none;
        border-radius: 10px;
        padding: 10px 16px;
        font-weight: 600;
        cursor: pointer;
    }

    .btn-secondary {
        background: transparent;
        border: 1px solid var(--border-light);
        border-radius: 10px;
        padding: 10px 16px;
        color: var(--text-primary);
        cursor: pointer;
    }
</style>
{% endblock %}

{% block content %}
<div class="settings-page">
    <div class="settings-card">
        <h2>Profile</h2>
        <p>Update the details visitors see on your portfolio.</p>
        <div class="settings-field">
            <label for="display_name">Display name</label>
            <input id="display_name" name="display_name" type="text" value="{{ current_user.display_name }}" />
        </div>
        <div class="settings-field">
            <label for="bio">Bio</label>
            <textarea id="bio" name="bio" rows="3" placeholder="Short introduction"></textarea>
        </div>
        <div class="settings-actions">
            <button class="btn-primary" type="button">Save profile</button>
            <button class="btn-secondary" type="button">Cancel</button>
        </div>
    </div>

    <div class="settings-card">
        <h2>AI Metadata Style</h2>
        <p>Choose how AI generates titles, captions, and descriptions for your images.</p>
        <div class="settings-field">
            <label for="ai_style">Description style</label>
            <select id="ai_style" name="ai_style">
                <option value="minimal" {% if current_user.ai_style == 'minimal' %}selected{% endif %}>Minimal - Just the facts, no flowery language</option>
                <option value="technical" {% if current_user.ai_style == 'technical' %}selected{% endif %}>Technical - Composition, lighting, craft</option>
                <option value="balanced" {% if current_user.ai_style == 'balanced' or not current_user.ai_style %}selected{% endif %}>Balanced - Professional mix (default)</option>
                <option value="documentary" {% if current_user.ai_style == 'documentary' %}selected{% endif %}>Documentary - Journalistic, contextual</option>
                <option value="artistic" {% if current_user.ai_style == 'artistic' %}selected{% endif %}>Artistic - Evocative, gallery-quality</option>
            </select>
        </div>
        <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 8px; line-height: 1.5;">
            <strong>Minimal:</strong> "Oak Tree in Winter Field" - Bare facts, avoids AI-speak<br>
            <strong>Technical:</strong> "Foggy Valley at Dawn" - Photography craft focus<br>
            <strong>Balanced:</strong> Professional tone, technical + artistic<br>
            <strong>Documentary:</strong> "Street Market in Morning Light" - Who, what, where, when<br>
            <strong>Artistic:</strong> "Whispers of Morning Mist" - Poetic, emotional
        </div>
        <div class="settings-actions">
            <button class="btn-primary" type="button" onclick="saveAIStyle()">Save AI style</button>
            <button class="btn-secondary" type="button">Cancel</button>
        </div>
    </div>

    <div class="settings-card">
        <h2>Analytics Tracking</h2>
        <p>Control how your own activity is tracked in analytics.</p>
        <div class="settings-field">
            <label>
                <input type="checkbox" id="track_own_activity" name="track_own_activity"
                       {% if current_user.track_own_activity %}checked{% endif %}>
                Include my own activity in analytics
            </label>
        </div>
        <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 8px; line-height: 1.5;">
            When enabled, your clicks and views are tracked separately from visitor activity.
            You can toggle between "Visitors Only", "My Activity", and "Combined" views in the analytics dashboard.
            When disabled, your activity is not tracked at all.
        </div>
        <div class="settings-actions">
            <button class="btn-primary" type="button" onclick="saveTrackingPreference()">Save tracking preference</button>
            <button class="btn-secondary" type="button">Cancel</button>
        </div>
    </div>

    <div class="settings-card">
        <h2>Notifications</h2>
        <p>Choose how you want to hear about uploads, shares, and analytics.</p>
        <div class="settings-field">
            <label for="email_frequency">Email frequency</label>
            <select id="email_frequency" name="email_frequency">
                <option value="daily">Daily summary</option>
                <option value="weekly" selected>Weekly digest</option>
                <option value="off">Off</option>
            </select>
        </div>
        <div class="settings-field">
            <label>
                <input type="checkbox" name="upload_alerts" checked>
                Notify me when uploads finish
            </label>
        </div>
        <div class="settings-actions">
            <button class="btn-primary" type="button">Save preferences</button>
            <button class="btn-secondary" type="button">Cancel</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
async function saveAIStyle() {
    const aiStyle = document.getElementById('ai_style').value;
    const button = event.target;

    button.disabled = true;
    button.textContent = 'Saving...';

    try {
        const response = await fetch('/api/users/me', {
            method: 'PATCH',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ ai_style: aiStyle })
        });

        if (response.ok) {
            button.textContent = 'Saved!';
            button.style.background = 'var(--success)';
            setTimeout(() => {
                button.textContent = 'Save AI style';
                button.style.background = 'var(--accent)';
                button.disabled = false;
            }, 2000);
        } else {
            const error = await response.json();
            alert('Error saving AI style: ' + (error.detail || 'Unknown error'));
            button.textContent = 'Save AI style';
            button.disabled = false;
        }
    } catch (error) {
        alert('Network error: ' + error.message);
        button.textContent = 'Save AI style';
        button.disabled = false;
    }
}

async function saveTrackingPreference() {
    const trackOwnActivity = document.getElementById('track_own_activity').checked;
    const button = event.target;

    button.disabled = true;
    button.textContent = 'Saving...';

    try {
        const response = await fetch('/api/users/me', {
            method: 'PATCH',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ track_own_activity: trackOwnActivity })
        });

        if (response.ok) {
            button.textContent = 'Saved!';
            button.style.background = 'var(--success)';
            setTimeout(() => {
                button.textContent = 'Save tracking preference';
                button.style.background = 'var(--accent)';
                button.disabled = false;
            }, 2000);
        } else {
            const error = await response.json();
            alert('Error saving tracking preference: ' + (error.detail || 'Unknown error'));
            button.textContent = 'Save tracking preference';
            button.disabled = false;
        }
    } catch (error) {
        alert('Network error: ' + error.message);
        button.textContent = 'Save tracking preference';
        button.disabled = false;
    }
}
</script>
{% endblock %}
